<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACO-HABITAT | Diagnostic Satellite</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white font-sans">

    <nav class="p-6 border-b border-slate-800 bg-slate-900 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black tracking-tighter text-blue-400">ACO<span class="text-white">-HABITAT</span></h1>
            <div class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full text-xs font-bold border border-blue-500/20">
                MODE SATELLITE ACTIF
            </div>
        </div>
    </nav>

    <main class="container mx-auto max-w-2xl pt-12 px-4">
        <div class="text-center mb-12">
            <h2 class="text-4xl font-extrabold mb-4">Diagnostic Toiture IA</h2>
            <p class="text-slate-400">Importez une vue satellite pour une analyse immédiate.</p>
        </div>

        <div class="bg-slate-800 rounded-3xl p-8 border border-slate-700 shadow-2xl">
            <div class="mb-8">
                <label class="relative flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-600 rounded-2xl cursor-pointer hover:bg-slate-700/50 transition-all group">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-10 h-10 mb-3 text-slate-500 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                        <p class="text-sm text-slate-400"><span class="font-semibold text-white">Cliquez pour choisir</span> ou glissez une photo</p>
                    </div>
                    <input id="photoToit" type="file" class="hidden" accept="image/*" />
                </label>
            </div>

            <button id="btnAnalyse" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-5 rounded-2xl shadow-lg shadow-blue-900/20 transition-all flex items-center justify-center gap-3">
                LANCER L'ANALYSE PAR SATELLITE
            </button>

            <div id="resultatZone" class="hidden mt-8 p-6 bg-slate-900/50 rounded-2xl border border-slate-700">
                <h3 class="text-blue-400 font-bold mb-4 flex items-center gap-2">
                    <span class="relative flex h-3 w-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                    </span>
                    RAPPORT D'EXPERTISE IA
                </h3>
                <div id="texteRapport" class="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap"></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { GoogleGenAI } from "https://esm.sh/@google/genai@0.1.0";

        // --- TA CLÉ ICI ---
        const API_KEY = "COLLE_TA_CLE_ICI_ENTRE_LES_GUILLEMETS";

        const btn = document.getElementById('btnAnalyse');
        const input = document.getElementById('photoToit');
        const rapport = document.getElementById('texteRapport');
        const zone = document.getElementById('resultatZone');

        btn.onclick = async () => {
            if(!input.files[0]) return alert("Choisis une photo d'abord !");
            
            btn.innerText = "CONNEXION SATELLITE...";
            btn.disabled = true;

            try {
                const genAI = new GoogleGenAI(API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

                const reader = new FileReader();
                reader.readAsDataURL(input.files[0]);
                reader.onload = async () => {
                    const base64Data = reader.result.split(',')[1];
                    
                    const result = await model.generateContent([
                        "Tu es l'expert ACO-HABITAT. Analyse cette image satellite de toiture. Identifie les matériaux, les défauts (mousse, tuiles cassées) et donne une urgence Faible, Moyenne ou Haute.",
                        { inlineData: { data: base64Data, mimeType: input.files[0].type } }
                    ]);

                    zone.classList.remove('hidden');
                    rapport.innerText = result.response.text();
                    btn.innerText = "ANALYSE TERMINÉE";
                };
            } catch (e) {
                alert("Erreur : " + e.message);
                btn.disabled = false;
                btn.innerText = "RÉESSAYER";
            }
        };
    </script>
</body>
</html>

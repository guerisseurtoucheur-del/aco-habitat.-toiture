<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACO-HABITAT | Diagnostic Toiture Satellite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .prose h3 { margin-top: 1.25em; margin-bottom: 0.5em; font-size: 1.125rem; font-weight: 600; color: #1f2937; }
        .prose p { margin-bottom: 0.75em; line-height: 1.6; }
    </style>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "@google/genai": "https://esm.sh/@google/genai@0.1.0"
        }
      }
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="module">
      import React, { useState, useCallback } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI } from "@google/genai";

      // --- CONFIGURATION ---
      // Note : Sur Vercel, on utilise une astuce pour lire la clé sans planter
      const API_KEY = "TA_CLE_API_ICI"; // Tu peux la coller ici temporairement pour tester

      const App = () => {
        const [imageUrl, setImageUrl] = useState(null);
        const [imageFile, setImageFile] = useState(null);
        const [report, setReport] = useState(null);
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);

        const fileToBase64 = (file) => new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => {
            const [header, data] = reader.result.split(',');
            resolve({ mimeType: file.type, data });
          };
          reader.onerror = reject;
        });

        const handleAnalyze = async () => {
          if (!imageFile) return;
          setIsLoading(true);
          setError(null);
          try {
            const genAI = new GoogleGenAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
            
            const imageData = await fileToBase64(imageFile);
            const result = await model.generateContent([
              "Analyse cette image satellite de toiture. Identifie le type de materiaux, l'état (mousse, usure) et donne une note d'urgence.",
              { inlineData: imageData }
            ]);
            
            setReport(result.response.text());
          } catch (err) {
            setError("Erreur : Vérifiez votre clé API ou le format de l'image.");
            console.error(err);
          } finally {
            setIsLoading(false);
          }
        };

        return React.createElement("div", { className: "min-h-screen" }, [
          // Header
          React.createElement("nav", { className: "bg-white shadow p-4", key: "nav" }, 
            React.createElement("h1", { className: "text-2xl font-bold text-blue-900 text-center" }, "ACO-HABITAT")
          ),
          // Hero
          React.createElement("header", { className: "hero-gradient text-white py-12 px-4 text-center", key: "hero" }, [
            React.createElement("h2", { className: "text-3xl font-bold mb-2" }, "Diagnostic Toiture Satellite"),
            React.createElement("p", { className: "opacity-90" }, "Analyse instantanée par IA")
          ]),
          // Main
          React.createElement("main", { className: "container mx-auto -mt-8 p-4", key: "main" }, 
            React.createElement("div", { className: "bg-white rounded-xl shadow-xl p-6 max-w-2xl mx-auto" }, [
              React.createElement("input", { 
                type: "file", 
                accept: "image/*", 
                onChange: (e) => {
                  const file = e.target.files[0];
                  setImageFile(file);
                  setImageUrl(URL.createObjectURL(file));
                },
                className: "mb-4 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
              }),
              imageUrl && React.createElement("img", { src: imageUrl, className: "w-full rounded mb-4 shadow" }),
              React.createElement("button", {
                onClick: handleAnalyze,
                disabled: !imageFile || isLoading,
                className: "w-full bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 disabled:bg-gray-300"
              }, isLoading ? "Analyse en cours..." : "Lancer l'Analyse"),
              report && React.createElement("div", { className: "mt-6 p-4 bg-blue-50 rounded border border-blue-100 prose text-sm" }, report),
              error && React.createElement("p", { className: "mt-4 text-red-500 text-center" }, error)
            ])
          )
        ]);
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
</body>
</html>
